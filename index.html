<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Flood Forecast Viewer</title>

    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

    <style>
        body { margin: 0; font-family: sans-serif; }
        #map {
            width: 100vw;
            height: 100vh;
            position: relative;
            z-index: 1;
        }

        /* --- FIXED: Make controls appear ABOVE the map --- */
        .controls {
            position: absolute;
            bottom: 15px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255,255,255,0.88);
            padding: 12px 16px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.25);

            z-index: 99999; /* Key fix */
        }

        input[type="range"] {
            width: 200px;
            position: relative;
            z-index: 99999;
        }

        #playBtn {
            position: relative;
            z-index: 99999;
            cursor: pointer;
        }
    </style>
</head>

<body>

<div class="controls">
    <div>
        <label>Time step: </label>
        <input id="timeSlider" type="range" min="0" max="1000" value="0">
    </div>
    <div style="margin-top:6px;">
        <label>Opacity: </label>
        <input id="opacitySlider" type="range" min="0" max="1" step="0.05" value="0.8">
    </div>
    <button id="playBtn" style="margin-top:6px;">Play</button>
</div>

<div id="map"></div>

<script>

    // -------------------------------
    // Base map
    // -------------------------------
    const map = L.map('map').setView([18.78632, 100.77215], 14);

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: 'Map data © OpenStreetMap (contributors); Flood model © Kwanchai Pakoksung (developer)'
    }).addTo(map);


    // -------------------------------
    // Flood overlay time series
    // -------------------------------
    const floodFrames = [
         "plt_0000.png",
         "plt_0030.png",
         "plt_0060.png",
         "plt_0090.png",
         "plt_0120.png",
         "plt_0150.png",
         "plt_0180.png",
         "plt_0210.png",
         "plt_0240.png",
         "plt_0270.png",
         "plt_0300.png",
         "plt_0330.png",
         "plt_0360.png",
         "plt_0390.png",
         "plt_0420.png",
         "plt_0450.png",
         "plt_0480.png",
         "plt_0510.png",
         "plt_0540.png",
         "plt_0570.png",
         "plt_0600.png",
         "plt_0630.png",
         "plt_0660.png",
         "plt_0690.png",
         "plt_0720.png",
         "plt_0750.png",
         "plt_0780.png",
         "plt_0810.png",
         "plt_0840.png",
         "plt_0870.png",
         "plt_0900.png",
         "plt_0930.png",
         "plt_0960.png",
         "plt_0990.png",
         "plt_1020.png",
         "plt_1050.png",
         "plt_1080.png",
         "plt_1110.png",
         "plt_1140.png",
         "plt_1170.png",
         "plt_1200.png",
         "plt_1230.png",
         "plt_1260.png",
         "plt_1290.png",
         "plt_1320.png",
         "plt_1350.png",
         "plt_1380.png",
         "plt_1410.png",
         "plt_1440.png",
         "plt_1470.png",
         "plt_1500.png",
         "plt_1530.png",
         "plt_1560.png",
         "plt_1590.png",
         "plt_1620.png",
         "plt_1650.png",
         "plt_1680.png",
         "plt_1710.png",
         "plt_1740.png",
         "plt_1770.png",
         "plt_1800.png",
         "plt_1830.png",
         "plt_1860.png",
         "plt_1890.png",
         "plt_1920.png",
         "plt_1950.png",
         "plt_1980.png",
         "plt_2010.png",
         "plt_2040.png",
         "plt_2070.png",
         "plt_2100.png",
         "plt_2130.png",
         "plt_2160.png",
         "plt_2190.png",
         "plt_2220.png",
         "plt_2250.png",
         "plt_2280.png",
         "plt_2310.png",
         "plt_2340.png",
         "plt_2370.png",
         "plt_2400.png",
         "plt_2430.png",
         "plt_2460.png",
         "plt_2490.png",
         "plt_2520.png",
         "plt_2550.png",
         "plt_2580.png",
         "plt_2610.png",
         "plt_2640.png",
         "plt_2670.png",
         "plt_2700.png",
         "plt_2730.png",
         "plt_2760.png",
         "plt_2790.png",
         "plt_2820.png",
         "plt_2850.png",
         "plt_2880.png",
         "plt_2910.png"
    ];

    const imageBounds = [[18.7523612976000003, 100.7512512206999986], [18.8237501863473398, 100.8045845539275831]];

    let currentFrame = 0;
    let overlay = L.imageOverlay(floodFrames[currentFrame], imageBounds, {opacity: 0.6}).addTo(map);


    // -------------------------------
    // Slider — change frame
    // -------------------------------
    const timeSlider = document.getElementById("timeSlider");
    timeSlider.addEventListener("input", () => {
        currentFrame = parseInt(timeSlider.value);
        updateOverlay();
    });


    // -------------------------------
    // Opacity slider
    // -------------------------------
    const opacitySlider = document.getElementById("opacitySlider");
    opacitySlider.addEventListener("input", () => {
        overlay.setOpacity(parseFloat(opacitySlider.value));
    });


    // -------------------------------
    // Play button
    // -------------------------------
    let playing = false;
    let timer = null;

    document.getElementById("playBtn").onclick = () => {
        if (!playing) {
            playing = true;
            document.getElementById("playBtn").innerText = "Pause";
            timer = setInterval(() => {
                currentFrame = (currentFrame + 1) % floodFrames.length;
                timeSlider.value = currentFrame;
                updateOverlay();
            }, 200);
        } else {
            playing = false;
            document.getElementById("playBtn").innerText = "Play";
            clearInterval(timer);
        }
    };


    // -------------------------------
    // Update overlay
    // -------------------------------
    function updateOverlay() {
        map.removeLayer(overlay);
        overlay = L.imageOverlay(
            floodFrames[currentFrame],
            imageBounds,
            { opacity: parseFloat(opacitySlider.value) }
        ).addTo(map);
    }

</script>

</body>
</html>








